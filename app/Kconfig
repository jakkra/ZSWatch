# ZSWatch board configuration

# Copyright (c) 2025 ZSWatch Project
# SPDX-License-Identifier: Apache-2.0

menu "Zephyr Kernel"
    source "Kconfig.zephyr"
endmenu

menu "ZSWatch"
    config ZSW_XIP
        bool
        prompt "Enable XIP"
        select HAVE_CUSTOM_LINKER_SCRIPT
        select CODE_DATA_RELOCATION
        select BUILD_NO_GAP_FILL
        select NORDIC_QSPI_NOR_XIP
        default n

    config ZSW_FW_UPDATE
        bool
        prompt "Enable firmware update"
        select NORDIC_QSPI_NOR
        select PM_OVERRIDE_EXTERNAL_DRIVER_CHECK
        select PM_PARTITION_REGION_SETTINGS_STORAGE_EXTERNAL
        select PM_PARTITION_REGION_LITTLEFS_EXTERNAL
        select NCS_SAMPLE_MCUMGR_BT_OTA_DFU
        # FOTA
        select MCUMGR
        select MCUMGR_GRP_OS
        select MCUMGR_GRP_OS_TASKSTAT
        select MCUMGR_GRP_FS
        select BT_GATT_DYNAMIC_DB
        select MCUMGR_TRANSPORT_BT_DYNAMIC_SVC_REGISTRATION
        select MCUMGR_MGMT_NOTIFICATION_HOOKS
        select MCUMGR_GRP_IMG
        select MCUMGR_GRP_IMG_UPLOAD_CHECK_HOOK
        select MCUMGR_GRP_IMG_IMAGE_SLOT_STATE_HOOK
        select MCUMGR_GRP_IMG_STATUS_HOOKS
        # Enable MCUMGR management for both OS and Images

        # Enable Shell over MCUmgr
        select MCUMGR_GRP_SHELL
        select SHELL
        select SHELL_MINIMAL
        select SHELL_BACKEND_DUMMY
        select SHELL_HELP
        select CONSOLE

        select BASE64
        select MCUMGR_TRANSPORT_DUMMY
        select MCUMGR_TRANSPORT_BT

        # Dependencies
        # Configure dependencies for select MCUMGR
        select NET_BUF
        select ZCBOR
        select CRC

        # Configure dependencies for select MCUMGR_GRP_IMG
        select FLASH
        select IMG_MANAGER

        # Configure dependencies for select IMG_MANAGER
        select STREAM_FLASH
        select FLASH_MAP

        default n

    rsource "src/applications/Kconfig"
    rsource "src/managers/Kconfig"
    rsource "drivers/Kconfig"
    rsource "src/ui/Kconfig"
    rsource "src/sensors/Kconfig"
    rsource "src/sensor_fusion/Kconfig"
    rsource "src/ble/Kconfig"

    menu "Default configuration"
        menu "ZSWatch Init Priorities"
            config DEFAULT_CONFIGURATION_DRIVER_INIT_PRIORITY
                int
                default 85
        endmenu

        menu "Power Management"
            config POWER_MANAGEMENT_IDLE_TIMEOUT_SECONDS
                int
            prompt "Idle timeout in seconds"
            default 20

            rsource "src/fuel_gauge/Kconfig"
        endmenu
    endmenu

    menu "SPI RTT Flash Loader"
        config SPI_FLASH_LOADER
            bool
        prompt "Enable SPI flash loader"
        default n
        select USE_SEGGER_RTT
        help
            "Enable SPI flash loader"

        if SPI_FLASH_LOADER
            config ERASE_PROGRESSIVELY
                bool
            depends on SPI_FLASH_LOADER
            prompt "Erase sectors one by one when writing instead of full partition before starting."
            default y
            help
                If not writing to the full partition this will be faster

            config RTT_TRANSFER_CHANNEL
                int
            depends on SPI_FLASH_LOADER
            prompt "The RTT channel to use for transfer of data to and form flash"
            default 2
            help
                If RTT logging is enabled, channel 0 is used for this, hence avoid 1 in this scenario.
        endif
    endmenu

    menu "Misc"
        config MISC_ENABLE_SYSTEM_RESET
            bool
        prompt "Enable a system reset via button 3"
        default n

        config MISC_HISTORY_MAX_LENGTH
            int
        range 10 65535
        prompt "The maximum history length in samples"
        default 672
    endmenu

    menu "Logging"
        module = ZSW_APP
        module-str = ZSW_APP
        source "subsys/logging/Kconfig.template.log_config"

        rsource "src/basic_battery/Kconfig"
        rsource "src/history/Kconfig"
    endmenu
endmenu
